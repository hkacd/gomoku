< html > < head > < title > gomoku < /title><style>body{margin:0}</style > < script src = "https://cdn.jsdelivr.net/npm/vue" > < /script></head > < body > < div id = "i0"
style = "position:absolute;top:300" > {
  {
    t1
  }
}
の番。 {
  {
    t2
  }
} < /div> < script > ia = -1;
PLa = 2;
WX = 14;
MX = 20;
mx = 0;
mi = 0;
CC = "●";
ib = -1;
PLb = 2;
WY = 14;
MY = 20;
my = 0;
MMMM = MX * MY;
PT = new Array(MMMM).fill(0);
CE = [];
WT = [];
PLAI = [];
addEventListener("mousedown", (ge) => {
  E_L();
});
addEventListener("mousemove", (ge) => {
  if (ib != (ia = ixy(ge.pageX, ge.pageY))) {
    if (ib >= 0 && PT[ib] == 0) {
      CE[ib].innerHTML = "+";
    }
    if (ia >= 0 && PT[ia] == 0) {
      CE[ia].innerHTML = "◇";
    }
    ib = ia;
  }
});
onload = () => {
  B_F1();
}

function E_L() {
  if (PLAI[PLb] ? A_I() : U_I()) {
    P_N();
    P_D();
    T_A();
  }
}

function B_F1() {
  PLAI[1] = false;
  PLAI[2] = true;
  I_N();
  I_D();
  T_A();
}

function D_X(d) {
  switch (d) {
  case (0):
    return (0);
  case (1):
    return (1);
  case (2):
    return (1);
  case (3):
    return (1);
  }
}

function D_Y(d) {
  switch (d) {
  case (0):
    return (1);
  case (1):
    return (0);
  case (2):
    return (1);
  case (3):
    return (-1);
  }
}

function outmxy(x, y) {
  if (x < 0 || MX <= x || y < 0 || MY <= y) {
    return (true);
  }
  return (false);
}

function ixy(px, py) {
  mx = parseInt(px / WX);
  my = parseInt(py / WY);
  mi = mx + my * MX;
  if (!outmxy(mx, my)) {
    if (0 == PT[mi]) {
      return (mi);
    }
  }
  return (mi = -1)
}

function U_I() {
  return (mi == -1 ? false : true);
}

function A_I() {
  let rit = -1,
    rv = -1;
  for (let it = 0; it < MMMM; it++) {
    if (rv < WT[it]) {
      rv = WT[it];
      rit = it;
    }
  }
  mi = rit;
  mx = rit % MX;
  my = parseInt(rit / MX);
  return (true);
}

function C_T(gc, gx, gy) {
  for (let itd = 0; itd < 4; itd++) {
    let dx = D_X(itd),
      dy = D_Y(itd),
      cnt = 0;
    for (let it1 = -4, lx = gx - 4 * dx, ly = gy - 4 * dy; it1 < 5; it1++, lx += dx, ly += dy) {
      if (outmxy(lx, ly)) {
        cnt = 0;
      } else if (gc == PT[lx + ly * MX]) {
        cnt++;
      } else {
        cnt = 0;
      }
      if (0 == PT[lx + ly * MX]) {
        W_T(gc, lx, ly);
      } else {
        WT[lx + ly * MX] = -9999;
      }
      if (cnt >= 5) {
        win(gc);
      }
    }
  }
}

function W_T(gc, gx, gy) {
  let sm = 0;
  for (let itd = 0; itd < 4; itd++) {
    let dx = D_X(itd),
      dy = D_Y(itd);
    for (let it2 = -4, lx2 = gx - 4 * dx, ly2 = gy - 4 * dy; it2 < 1; it2++, lx2 += dx, ly2 += dy) {
      let cnt_e = 1,
        cnt_m = 1;
      for (let it1 = 0, lx1 = lx2, ly1 = ly2; it1 < 5; it1++, lx1 += dx, ly1 += dy) {
        if (outmxy(lx1, ly1)) {
          cnt_e = cnt_m = 0;
        } else if (0 == PT[lx1 + ly1 * MX]) {} else if (gc == PT[lx1 + ly1 * MX]) {
          cnt_m *= 5;
          cnt_e = 0;
        } else {
          cnt_m = 0;
          cnt_e *= 5;
        }
      }
      sm += cnt_m + cnt_e;
    }
  }
  WT[gx + gy * MX] = sm;
}

function I_N() {
  for (let itx = 0; itx < MX; itx++) {
    for (let ity = 0; ity < MY; ity++) {
      W_T(1, itx, ity);
    }
  }
}

function I_D() {
  for (let it = 0; it < MMMM; it++) {
    CE[it] = document.createElement("span");
    document.body.appendChild(CE[it]);
    CE[it].innerHTML = "+";
    CE[it].style.position = "absolute";
    CE[it].style.top = WY * parseInt(it / MX) + "px";
    CE[it].style.left = WX * (it % MX) + "px";
  }
  e0 = new Vue({
    el: "#i0",
    data: {
      t1: 0,
      t2: 0
    }
  });
}

function P_D() {
  CE[mi].innerHTML = CC;
}

function P_N() {
  PT[mi] = PLb;
  C_T(PLb, mx, my);
}

function T_A() {
  if (PLb == 1) {
    PLb = 2;
    CC = "○";
    e0.t1 = "白";
  } else {
    PLb = 1;
    CC = "●";
    e0.t1 = "黒";
  }
  if (PLAI[PLb]) {
    e0.t2 = "画面クリックで進行";
  } else {
    e0.t2 = "置く交差点をクリック";
  }
}

function win(gc) {
  if (PLb == 1) {
    alert("黒の勝ち");
  } else {
    alert("白の勝ち");
  }
} < /script></body > < /html>
